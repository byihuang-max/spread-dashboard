<!DOCTYPE html>
<html lang="zh"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å¥—åˆ©ç¯å¢ƒ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,'PingFang SC','Helvetica Neue','Microsoft YaHei',sans-serif;background:transparent;color:#2d3142;padding:0;font-size:14px}
.card{background:#fff;border-radius:10px;padding:14px;margin-bottom:12px;border:1px solid #e8eaef}
.card-title{font-size:12px;font-weight:600;margin-bottom:8px;color:#2d3142}
.tabs{display:flex;gap:6px;margin-bottom:16px}
.tab{padding:7px 14px;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;background:#fff;border:1px solid #e8eaef;color:#8b92a5;transition:all .12s}
.tab:hover{color:#2d3142;border-color:#cbd5e1}
.tab.active{background:#2563eb;color:#fff;border-color:#2563eb}
.tab-page{display:none}.tab-page.active{display:block}
.ov-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:16px}
.ov{background:#fff;border-radius:8px;padding:12px;border:1px solid #e8eaef;text-align:center}
.ov .label{font-size:11px;color:#8b92a5;margin-bottom:2px}
.ov .val{font-size:22px;font-weight:700;margin:2px 0}
.ov .sub{font-size:10px;color:#8b92a5}
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
@media(max-width:768px){.chart-grid{grid-template-columns:1fr}}
.pos{color:#e74c3c}.neg{color:#27ae60}
</style>
</head><body>

<div class="tabs">
  <div class="tab active" data-tab="index-arb">ğŸ“Š è‚¡æŒ‡å¥—åˆ©</div>
  <div class="tab" data-tab="commodity-arb">ğŸ­ å•†å“å¥—åˆ©</div>
  <div class="tab" data-tab="option-arb">ğŸ“ˆ æœŸæƒå¥—åˆ©</div>
</div>

<!-- â•â•â• Tab 1: è‚¡æŒ‡å¥—åˆ© â•â•â• -->
<div class="tab-page active" id="tab-index-arb">
  <div class="ov-grid" id="idx-overview"></div>
  <div class="chart-grid">
    <div class="card">
      <div class="card-title">åŸºå·®ç‡èµ°åŠ¿ï¼ˆ%ï¼‰</div>
      <div style="position:relative;height:220px"><canvas id="chartBasis"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">å¹´åŒ–åŸºå·®ç‡èµ°åŠ¿ï¼ˆ%ï¼‰</div>
      <div style="position:relative;height:220px"><canvas id="chartAnnual"></canvas></div>
    </div>
  </div>
  <div class="card">
    <div class="card-title">æŒä»“é‡èµ°åŠ¿</div>
    <div style="position:relative;height:220px"><canvas id="chartOI"></canvas></div>
  </div>
  <div class="card" style="font-size:11px;color:#8b92a5;line-height:1.7">
    <div style="font-size:12px;font-weight:600;color:#2d3142;margin-bottom:6px">ğŸ“– æŒ‡æ ‡è¯´æ˜</div>
    â‘  <b>åŸºå·®</b> = æœŸè´§ä»·æ ¼ âˆ’ ç°è´§ä»·æ ¼ã€‚è´ŸåŸºå·®ï¼ˆè´´æ°´ï¼‰= æœŸè´§æ¯”ç°è´§ä¾¿å®œï¼Œæ­£åŸºå·®ï¼ˆå‡æ°´ï¼‰= æœŸè´§æ¯”ç°è´§è´µ<br>
    â‘¡ <b>åŸºå·®ç‡</b> = åŸºå·® / ç°è´§ä»·æ ¼ Ã— 100%ï¼Œæ ‡å‡†åŒ–åå¯è·¨å“ç§å¯¹æ¯”<br>
    â‘¢ <b>å¹´åŒ–åŸºå·®ç‡</b> = åŸºå·®ç‡ / å‰©ä½™åˆ°æœŸå¤©æ•° Ã— 365ï¼Œåæ˜ æŒæœ‰æ”¶ç›Šçš„å¹´åŒ–æ°´å¹³<br>
    â‘£ <b>æŒä»“é‡ï¼ˆOIï¼‰</b>ï¼šæœªå¹³ä»“åˆçº¦æ•°ï¼Œåæ˜ å¸‚åœºå‚ä¸åº¦å’Œèµ„é‡‘æ²‰æ·€<br>
    â‘¤ <b>ç”¨æ³•</b>ï¼šæ·±è´´æ°´ï¼ˆè´ŸåŸºå·®ç‡å¤§ï¼‰â†’ å¤šå¤´å±•æœŸæœ‰åˆ© / å¯¹å†²æˆæœ¬ä½ï¼›å‡æ°´æ‰©å¤§ â†’ è­¦æƒ•å¤šå¤´æ‹¥æŒ¤
  </div>
</div>

<!-- â•â•â• Tab 2: å•†å“å¥—åˆ© â•â•â• -->
<div class="tab-page" id="tab-commodity-arb">
  <div class="ov-grid" id="cmd-overview"></div>
  <div class="chart-grid">
    <div class="card">
      <div class="card-title">è·¨å“ç§æ¯”ä»·èµ°åŠ¿</div>
      <div style="position:relative;height:220px"><canvas id="chartRatio"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Z-Score èµ°åŠ¿</div>
      <div style="position:relative;height:220px"><canvas id="chartZscore"></canvas></div>
    </div>
  </div>
  <div class="card" style="font-size:11px;color:#8b92a5;line-height:1.7">
    <div style="font-size:12px;font-weight:600;color:#2d3142;margin-bottom:6px">ğŸ“– æŒ‡æ ‡è¯´æ˜</div>
    â‘  <b>è·¨å“ç§æ¯”ä»·</b> = å“ç§Aä»·æ ¼ / å“ç§Bä»·æ ¼ï¼Œåæ˜ äº§ä¸šé“¾ä¸Šä¸‹æ¸¸æˆ–æ›¿ä»£å“çš„ç›¸å¯¹å¼ºå¼±<br>
    â‘¡ <b>Z-Score</b> = (å½“å‰æ¯”ä»· âˆ’ å‡å€¼) / æ ‡å‡†å·®ï¼Œè¡¡é‡æ¯”ä»·åç¦»å†å²ä¸­æ¢çš„ç¨‹åº¦ã€‚|Z|>2 ä¸ºæç«¯åŒºé—´<br>
    â‘¢ <b>åˆ†ä½æ•°</b>ï¼šå½“å‰æ¯”ä»·åœ¨å†å²çª—å£ä¸­çš„ç™¾åˆ†ä½ï¼Œ0%=å†å²æœ€ä½ï¼Œ100%=å†å²æœ€é«˜<br>
    â‘£ <b>é…å¯¹</b>ï¼šèºçº¹/é“çŸ¿ï¼ˆé’¢å‚åˆ©æ¶¦ï¼‰ã€è±†æ²¹/æ£•æ¦ˆæ²¹ï¼ˆæ²¹è„‚æ›¿ä»£ï¼‰ã€é“œ/é“ï¼ˆæœ‰è‰²å¼ºå¼±ï¼‰ã€åŸæ²¹/ç‡ƒæ²¹ï¼ˆç‚¼åŒ–ä»·å·®ï¼‰<br>
    â‘¤ <b>ç”¨æ³•</b>ï¼šZ-Score æç«¯ + åˆ†ä½æ•°æç«¯ â†’ å‡å€¼å›å½’æœºä¼šï¼›è¶‹åŠ¿æ€§åç¦» â†’ äº§ä¸šé€»è¾‘å˜åŒ–éœ€éªŒè¯
  </div>
</div>

<!-- â•â•â• Tab 3: æœŸæƒå¥—åˆ© â•â•â• -->
<div class="tab-page" id="tab-option-arb">
  <div class="ov-grid" id="opt-overview"></div>
  <div class="chart-grid">
    <div class="card">
      <div class="card-title">PCRï¼ˆæˆäº¤é‡ï¼‰èµ°åŠ¿</div>
      <div style="position:relative;height:220px"><canvas id="chartPCR"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">HV20 å†å²æ³¢åŠ¨ç‡ï¼ˆ%ï¼‰& æ€»æˆäº¤é‡</div>
      <div style="position:relative;height:220px"><canvas id="chartHV"></canvas></div>
    </div>
  </div>
  <div class="card" style="font-size:11px;color:#8b92a5;line-height:1.7">
    <div style="font-size:12px;font-weight:600;color:#2d3142;margin-bottom:6px">ğŸ“– æŒ‡æ ‡è¯´æ˜</div>
    â‘  <b>PCRï¼ˆæˆäº¤é‡ï¼‰</b> = Putæˆäº¤é‡ / Callæˆäº¤é‡ï¼Œ>1 è¡¨ç¤ºçœ‹è·Œæƒ…ç»ªåé‡ï¼Œ<1 è¡¨ç¤ºçœ‹æ¶¨æƒ…ç»ªåé‡<br>
    â‘¡ <b>PCRï¼ˆæŒä»“é‡ï¼‰</b> = PutæŒä»“é‡ / CallæŒä»“é‡ï¼Œæ¯”æˆäº¤é‡PCRæ›´ç¨³å®šï¼Œåæ˜ ä¸­æœŸæƒ…ç»ª<br>
    â‘¢ <b>HV20</b> = 20æ—¥å†å²æ³¢åŠ¨ç‡ï¼Œç”¨æ²ªæ·±300æ”¶ç›˜ä»·è®¡ç®—ã€‚é«˜HV = å¸‚åœºæ³¢åŠ¨å¤§ï¼ŒæœŸæƒå®šä»·è´µ<br>
    â‘£ <b>æ€»æˆäº¤é‡</b>ï¼šå…¨å¸‚åœºæœŸæƒåˆçº¦æˆäº¤é‡ï¼Œåæ˜ æœŸæƒå¸‚åœºæ´»è·ƒåº¦å’ŒæŠ•æœº/å¯¹å†²éœ€æ±‚<br>
    â‘¤ <b>ç”¨æ³•</b>ï¼šPCRæé«˜ + HVé£™å‡ â†’ ææ…Œè§åº•ä¿¡å·ï¼›PCRæä½ + æˆäº¤é‡èç¼© â†’ ä¹è§‚è¿‡å¤´éœ€è­¦æƒ•
  </div>
</div>

<script>
var base=(function(){var h=location.href.replace(/[?#].*$/,'');var m=h.match(/\/arbitrage\b/);if(m)return h.slice(0,m.index)+'/arbitrage/';return h.replace(/[^/]*$/,'')})();

// Tab åˆ‡æ¢ + æ‡’åŠ è½½
var inited={};
document.querySelectorAll('.tab').forEach(function(t){
  t.addEventListener('click',function(){
    document.querySelectorAll('.tab').forEach(function(x){x.classList.remove('active')});
    document.querySelectorAll('.tab-page').forEach(function(x){x.classList.remove('active')});
    t.classList.add('active');
    var tab=t.dataset.tab;
    document.getElementById('tab-'+tab).classList.add('active');
    // æ‡’åŠ è½½ï¼šåˆ‡åˆ° tab æ‰åˆå§‹åŒ–å›¾è¡¨
    if(!inited[tab]){inited[tab]=true;setTimeout(function(){loaders[tab]&&loaders[tab]()},50);}
  });
});

function fmtDate(d){return d.slice(0,4)+'-'+d.slice(4,6)+'-'+d.slice(6,8)}
function clr(v){return v>=0?'#e74c3c':'#27ae60'}
function sign(v){return v>=0?'+'+v:v}
var COLORS=['#e74c3c','#3498db','#f39c12','#9b59b6','#2ecc71','#e67e22'];
var chartOpts={plugins:{legend:{labels:{font:{size:11}}}},maintainAspectRatio:false,responsive:true};

var loaders={};

// â•â•â• è‚¡æŒ‡å¥—åˆ© â•â•â•
function loadIndexArb(){
fetch(base+'mod1_index_arb.json').then(function(r){return r.json()}).then(function(D){
  var contracts=D.contracts, summary=D.summary;
  var html='';
  var keys=['IF','IH','IC','IM'];
  keys.forEach(function(k){
    var s=summary[k];if(!s)return;
    var c=clr(s.latest_basis_pct);
    html+='<div class="ov"><div class="label">'+k+'('+s.name+')</div>'
      +'<div class="val" style="color:'+c+'">'+sign(s.latest_basis.toFixed(1))+'</div>'
      +'<div class="sub">åŸºå·®ç‡ '+sign(s.latest_basis_pct.toFixed(3))+'% | å¹´åŒ– '+sign(s.latest_annual_pct.toFixed(1))+'%</div>'
      +'<div class="sub">30æ—¥å‡å€¼ '+sign(s.avg_basis_pct.toFixed(3))+'%</div></div>';
  });
  document.getElementById('idx-overview').innerHTML=html;

  var labels=contracts.IF.series.map(function(r){return fmtDate(r.date)});
  var datasets=[];
  keys.forEach(function(k,i){
    datasets.push({label:k,data:contracts[k].series.map(function(r){return r.basis_pct}),borderColor:COLORS[i],borderWidth:1.5,pointRadius:0,tension:0.2});
  });
  new Chart(document.getElementById('chartBasis'),{type:'line',data:{labels:labels,datasets:datasets},options:Object.assign({},chartOpts,{scales:{y:{title:{display:true,text:'%'}}}})});

  var ds2=[];
  keys.forEach(function(k,i){
    ds2.push({label:k,data:contracts[k].series.map(function(r){return r.annual_basis_pct}),borderColor:COLORS[i],borderWidth:1.5,pointRadius:0,tension:0.2});
  });
  new Chart(document.getElementById('chartAnnual'),{type:'line',data:{labels:labels,datasets:ds2},options:Object.assign({},chartOpts,{scales:{y:{title:{display:true,text:'%'}}}})});

  var ds3=[];
  keys.forEach(function(k,i){
    ds3.push({label:k,data:contracts[k].series.map(function(r){return r.fut_oi}),borderColor:COLORS[i],borderWidth:1.5,pointRadius:0,tension:0.2,fill:false});
  });
  new Chart(document.getElementById('chartOI'),{type:'line',data:{labels:labels,datasets:ds3},options:Object.assign({},chartOpts,{scales:{y:{title:{display:true,text:'æ‰‹'}}}})});
}).catch(function(e){console.error('mod1 load error',e)});
}
// é¦–æ¬¡åŠ è½½
inited['index-arb']=true;
loadIndexArb();

// â•â•â• å•†å“å¥—åˆ© â•â•â•
loaders['commodity-arb']=function(){
fetch(base+'mod2_commodity_arb.json').then(function(r){return r.json()}).then(function(D){
  var spreads=D.spreads, summary=D.summary;
  var keys=Object.keys(spreads);

  var html='';
  keys.forEach(function(k){
    var s=summary[k];if(!s)return;
    var zc=s.latest_z_score>=0?'#e74c3c':'#27ae60';
    html+='<div class="ov"><div class="label">'+s.name+'</div>'
      +'<div class="val">'+s.latest_ratio.toFixed(4)+'</div>'
      +'<div class="sub">Z-Score <span style="color:'+zc+'">'+sign(s.latest_z_score.toFixed(2))+'</span> | åˆ†ä½ '+(s.latest_pctile*100).toFixed(0)+'%</div>'
      +'<div class="sub">30æ—¥å‡å€¼ '+s.avg_ratio.toFixed(4)+'</div></div>';
  });
  document.getElementById('cmd-overview').innerHTML=html;

  var firstKey=keys[0];
  var labels=spreads[firstKey].series.map(function(r){return fmtDate(r.date)});
  var ds=[];
  keys.forEach(function(k,i){
    var sp=spreads[k];
    ds.push({label:sp.name,data:sp.series.map(function(r){return r.ratio}),borderColor:COLORS[i],borderWidth:1.5,pointRadius:0,tension:0.2});
  });
  new Chart(document.getElementById('chartRatio'),{type:'line',data:{labels:labels,datasets:ds},options:Object.assign({},chartOpts,{scales:{y:{position:'left'},y1:{position:'right',grid:{drawOnChartArea:false}}}})});

  var ds2=[];
  keys.forEach(function(k,i){
    var sp=spreads[k];
    ds2.push({label:sp.name,data:sp.series.map(function(r){return r.z_score}),borderColor:COLORS[i],borderWidth:1.5,pointRadius:0,tension:0.2});
  });
  new Chart(document.getElementById('chartZscore'),{type:'line',data:{labels:labels,datasets:ds2},options:Object.assign({},chartOpts,{scales:{y:{title:{display:true,text:'Z-Score'}}}})});
}).catch(function(e){console.error('mod2 load error',e)});
};

// â•â•â• æœŸæƒå¥—åˆ© â•â•â•
loaders['option-arb']=function(){
fetch(base+'mod3_option_arb.json').then(function(r){return r.json()}).then(function(D){
  var series=D.series, summary=D.summary;

  var html='';
  if(summary.latest_pcr_vol!=null){
    html+='<div class="ov"><div class="label">PCRï¼ˆæˆäº¤é‡ï¼‰</div><div class="val">'+summary.latest_pcr_vol.toFixed(4)+'</div><div class="sub">30æ—¥å‡å€¼ '+(summary.avg_pcr_vol||0).toFixed(4)+'</div></div>';
  }
  if(summary.latest_pcr_oi!=null){
    html+='<div class="ov"><div class="label">PCRï¼ˆæŒä»“é‡ï¼‰</div><div class="val">'+summary.latest_pcr_oi.toFixed(4)+'</div><div class="sub">å‡å€¼ '+(summary.avg_pcr_oi||0).toFixed(4)+'</div></div>';
  }
  if(summary.latest_hv_20!=null){
    html+='<div class="ov"><div class="label">HV20ï¼ˆæ²ªæ·±300ï¼‰</div><div class="val">'+summary.latest_hv_20.toFixed(1)+'%</div><div class="sub">å‡å€¼ '+(summary.avg_hv_20||0).toFixed(1)+'%</div></div>';
  }
  if(summary.latest_total_vol){
    html+='<div class="ov"><div class="label">æ€»æˆäº¤é‡</div><div class="val">'+(summary.latest_total_vol/10000).toFixed(0)+'ä¸‡</div><div class="sub">æˆäº¤é¢ '+(summary.latest_total_amount/10000).toFixed(0)+'äº¿</div></div>';
  }
  document.getElementById('opt-overview').innerHTML=html;

  var labels=series.map(function(r){return fmtDate(r.date)});

  new Chart(document.getElementById('chartPCR'),{type:'line',data:{labels:labels,datasets:[
    {label:'PCR(æˆäº¤é‡)',data:series.map(function(r){return r.pcr_vol}),borderColor:'#2ecc71',borderWidth:1.5,pointRadius:0,tension:0.2},
    {label:'PCR(æŒä»“é‡)',data:series.map(function(r){return r.pcr_oi}),borderColor:'#3498db',borderWidth:1.5,pointRadius:0,tension:0.2,borderDash:[4,3]}
  ]},options:chartOpts});

  new Chart(document.getElementById('chartHV'),{type:'line',data:{labels:labels,datasets:[
    {label:'HV20(%)',data:series.map(function(r){return r.hv_20}),borderColor:'#e67e22',borderWidth:1.5,pointRadius:0,tension:0.2,yAxisID:'y'},
    {label:'æ€»æˆäº¤é‡(ä¸‡æ‰‹)',data:series.map(function(r){return r.total_vol/10000}),borderColor:'#95a5a6',borderWidth:1,pointRadius:0,tension:0.2,fill:true,backgroundColor:'rgba(149,165,166,0.1)',yAxisID:'y1'}
  ]},options:Object.assign({},chartOpts,{scales:{y:{position:'left',title:{display:true,text:'%'}},y1:{position:'right',grid:{drawOnChartArea:false},title:{display:true,text:'ä¸‡æ‰‹'}}}})});
}).catch(function(e){console.error('mod3 load error',e)});
};
</script>
</body></html>
