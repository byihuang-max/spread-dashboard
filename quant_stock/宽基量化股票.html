<!DOCTYPE html>
<html lang="zh"><head><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å®½åŸºé‡åŒ–è‚¡ç¥¨</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,'PingFang SC','Helvetica Neue','Microsoft YaHei',sans-serif;background:#f5f6f8;color:#2d3142;padding:20px;font-size:14px}
.card{background:#fff;border-radius:10px;padding:18px;margin-bottom:16px;border:1px solid #e8eaef}
.card-title{font-size:13px;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:7px;color:#2d3142}
.card-title .dot{width:7px;height:7px;border-radius:50%;display:inline-block}
</style>
</head><body>

<div class="card">
  <div class="card-title"><span class="dot" style="background:#e74c3c"></span> å…¨å¸‚åœºæˆäº¤é¢æ—¶åºï¼ˆäº¿å…ƒï¼‰</div>
  <div style="position:relative;height:280px"><canvas id="chartAmount"></canvas></div>
</div>

<div class="card">
  <div class="card-title"><span class="dot" style="background:#3498db"></span> å®½åŸºæˆäº¤é¢å å…¨Aæ¯”ä¾‹ï¼ˆ%ï¼‰</div>
  <div style="position:relative;height:320px"><canvas id="chartShare"></canvas></div>
</div>

<div class="card">
  <div class="card-title"><span class="dot" style="background:#f39c12"></span> IF/IC/IM å¹´åŒ–åŸºå·®ï¼ˆ%ï¼‰</div>
  <div style="position:relative;height:280px"><canvas id="chartBasis"></canvas></div>
</div>

<div class="card">
  <div class="card-title"><span class="dot" style="background:#9b59b6"></span> å› å­è¶…é¢æ”¶ç›Šå‡€å€¼ï¼ˆvs ä¸­è¯å…¨æŒ‡ï¼‰</div>
  <div style="position:relative;height:280px"><canvas id="chartFactor"></canvas></div>
</div>

<div class="card" style="font-size:12px;color:#999;line-height:1.8">
  <div class="card-title" style="font-size:13px;color:#666"><span class="dot" style="background:#999"></span> ğŸ“ æŒ‡æ ‡è¯´æ˜</div>
  <p><b style="color:#555">â‘  å…¨å¸‚åœºæˆäº¤é¢ï¼š</b>ä¸­è¯å…¨æŒ‡(000985.CSI)æ—¥æˆäº¤é¢ï¼Œå•ä½äº¿å…ƒï¼Œåæ˜ å¸‚åœºæ•´ä½“æµåŠ¨æ€§æ°´å¹³</p>
  <p><b style="color:#555">â‘¡ å®½åŸºå æ¯”ï¼š</b>æ²ªæ·±300/ä¸­è¯500/1000/2000/ç§‘åˆ›50+åˆ›ä¸šæ¿æŒ‡ å„è‡ªæˆäº¤é¢å ä¸­è¯å…¨æŒ‡æ¯”ä¾‹ï¼Œè§‚å¯Ÿèµ„é‡‘ä¸»æˆ˜åœºè¿ç§»</p>
  <p><b style="color:#555">â‘¢ å¹´åŒ–åŸºå·®ï¼š</b>(ä¸»åŠ›åˆçº¦æ”¶ç›˜-ç°è´§æŒ‡æ•°æ”¶ç›˜)/ç°è´§ Ã— 12 Ã— 100ï¼Œè´Ÿå€¼=è´´æ°´ï¼ˆå¯¹å†²æˆæœ¬ï¼‰ï¼Œæ­£å€¼=å‡æ°´</p>
  <p><b style="color:#555">â‘£ å› å­è¶…é¢ï¼š</b>å„å› å­æŒ‡æ•°ç›¸å¯¹ä¸­è¯å…¨æŒ‡çš„æ—¥åº¦è¶…é¢æ”¶ç›Šç´¯è®¡å‡€å€¼ã€‚æˆé•¿=å›½è¯æˆé•¿(399370)ï¼Œçº¢åˆ©=ä¸­è¯çº¢åˆ©(000922)ï¼Œå°ç›˜=ä¸­è¯2000(932000)</p>
</div>

<script>
fetch('quant_stock_data.json').then(r=>r.json()).then(function(QS){
  function fmtDate(d){return d.slice(0,4)+'-'+d.slice(4,6)+'-'+d.slice(6,8)}
  function ma(arr,n){return arr.map(function(v,i){if(i<n-1)return null;var s=0;for(var j=i-n+1;j<=i;j++)s+=arr[j];return s/n})}

  var chartOpts={
    responsive:true,maintainAspectRatio:false,
    interaction:{mode:'index',intersect:false},
    plugins:{legend:{position:'bottom',labels:{boxWidth:12,font:{size:11}}}},
    scales:{x:{ticks:{maxTicksToShow:12,font:{size:10}}}}
  };

  // å›¾1: å…¨å¸‚åœºæˆäº¤é¢
  (function(){
    var d=QS.total_amount;
    var labels=d.map(function(r){return fmtDate(r.date)});
    var vals=d.map(function(r){return r.amount_yi});
    var ma20=ma(vals,20);
    new Chart(document.getElementById('chartAmount'),{
      type:'line',
      data:{labels:labels,datasets:[
        {label:'å…¨Aæˆäº¤é¢(äº¿)',data:vals,borderColor:'#e74c3c',backgroundColor:'rgba(231,76,60,0.08)',fill:true,borderWidth:1.5,pointRadius:0,tension:0.1},
        {label:'MA20',data:ma20,borderColor:'#f39c12',borderWidth:1.5,borderDash:[4,3],pointRadius:0,tension:0.1}
      ]},
      options:Object.assign({},chartOpts,{scales:{x:chartOpts.scales.x,y:{ticks:{callback:function(v){return v>=10000?(v/10000).toFixed(1)+'ä¸‡äº¿':v+'äº¿'}}}}})
    });
  })();

  // å›¾2: å®½åŸºæˆäº¤é¢å æ¯”
  (function(){
    var d=QS.index_share;
    var labels=d.map(function(r){return fmtDate(r.date)});
    var colors=['#e74c3c','#3498db','#2ecc71','#f39c12','#9b59b6'];
    var names=['æ²ªæ·±300','ä¸­è¯500','ä¸­è¯1000','ä¸­è¯2000','ç§‘åˆ›+åˆ›ä¸šæ¿'];
    var datasets=names.map(function(n,i){return{
      label:n,data:d.map(function(r){return r[n]||0}),
      borderColor:colors[i],borderWidth:1.5,pointRadius:0,tension:0.1,fill:false
    }});
    new Chart(document.getElementById('chartShare'),{
      type:'line',data:{labels:labels,datasets:datasets},
      options:Object.assign({},chartOpts,{scales:{x:chartOpts.scales.x,y:{ticks:{callback:function(v){return v+'%'}},min:0}}})
    });
  })();

  // å›¾3: å¹´åŒ–åŸºå·®
  (function(){
    var d=QS.basis;
    var labels=d.map(function(r){return fmtDate(r.date)});
    var colors={IF:'#e74c3c',IC:'#3498db',IM:'#2ecc71'};
    var nameMap={IF:'æ²ªæ·±300',IC:'ä¸­è¯500',IM:'ä¸­è¯1000'};
    var datasets=['IF','IC','IM'].map(function(k){return{
      label:k+'('+nameMap[k]+')',data:d.map(function(r){return r[k]||null}),
      borderColor:colors[k],borderWidth:1.5,pointRadius:0,tension:0.1,fill:false
    }});
    new Chart(document.getElementById('chartBasis'),{
      type:'line',data:{labels:labels,datasets:datasets},
      options:Object.assign({},chartOpts,{scales:{x:chartOpts.scales.x,y:{ticks:{callback:function(v){return v+'%'}}}}})
    });
  })();

  // å›¾4: å› å­è¶…é¢æ”¶ç›Š
  (function(){
    var d=QS.factor;
    var names=QS.factor_names;
    var labels=d.map(function(r){return fmtDate(r.date)});
    var colors=['#e74c3c','#3498db','#2ecc71','#f39c12','#9b59b6'];
    var datasets=names.map(function(n,i){return{
      label:n,data:d.map(function(r){return r[n]||null}),
      borderColor:colors[i],borderWidth:1.5,pointRadius:0,tension:0.1,fill:false
    }});
    new Chart(document.getElementById('chartFactor'),{
      type:'line',data:{labels:labels,datasets:datasets},
      options:Object.assign({},chartOpts,{scales:{x:chartOpts.scales.x,y:{ticks:{callback:function(v){return v.toFixed(2)}}}}})
    });
  })();
});
</script>
</body></html>
