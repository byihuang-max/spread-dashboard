# 量化宽基超额环境诊断 — 设计文档 v2

> 2026-03-01 Roni × Eva 共创

## 核心命题

**量化超额好不好做？** — 不是看指增产品净值，是看alpha环境。

## 五因子嵌套框架

### ① 流动性水位（前提条件）
- 全A成交额 + 20日均线 + 变异系数(CV)
- 枯竭直接红灯。**稳定放量 > 脉冲放量**
- 数据：amount_vol.json

### ② 个股离散度（alpha来源）
- 全A个股日收益率的截面标准差
- 高 = alpha空间大，低 = 同涨同跌选股没用
- 数据：cross_vol.json

### ③ 风格集中度（alpha杀手）
- 宽基成交额占比HHI + 因子极端演绎
- **与离散度是交互项**，不能简单加权
- 数据：quant_stock_data.json

### ④ 市场预期（情绪结构信号）
- 基差历史分位数 + **大票虹吸三条件验证**

**Roni关键洞察：**
- 基差是结果变量不是原因，必须用历史分位数
- 升水 ≠ 直接扣分，要验证大票虹吸是否成立
- 量化1000指增实际30%持仓在样本外偏小票，赚流动性和动量的钱
- 大票吸走流动性+小票跑输 = 量化持仓端被碾压

**三条件联合验证（升水时触发）：**

| 条件 | 指标 | 阈值 |
|------|------|------|
| A. 大票占比急增 | 300+500近5日占比 vs 近20日 | 差值>2pp |
| B. 大票跑赢小票 | 300近5日涨幅 vs 1000近5日 | 差值>2% |
| C. 基差升水/高分位 | IM>0 或分位>80% | — |

A+B+C全满足 → 🔴虹吸确认 → 超额承压
仅C → 🟡观察 → 不调整

### ⑤ 微观结构（尾部风险）
- 行业拥挤度 + 追高风险 + 三资金面共识
- 拥挤+偏空 = 踩踏预警
- 数据：crowding.json

## 嵌套逻辑

```
流动性枯竭 → 直接红灯

流动性正常以上:
  alpha环境 = 离散度 × 风格集中度（交互项）
  市场预期修正（条件验证，不粗暴扣分）
  微观尾部叠加
```

## 中性策略辅助

| 超额 vs 基差 | 状态 | 建议 |
|-------------|------|------|
| 超额 < 基差 | 亏钱 | ❌ 不配 |
| 超额 ≈ 基差 | 盈亏平衡 | 🟡 鸡肋 |
| 超额 > 基差 | 正收益 | 🟡 可看 |
| 超额 ≥ 2×基差 | 充足 | ✅ 有配置价值 |

## 文件

| 文件 | 说明 |
|------|------|
| quant_env_diag.py | 主诊断脚本 |
| quant_env_diag.json | 诊断输出 |
| cross_vol_data.py / cross_vol.json | 截面波动率 |
| amount_vol_calc.py / amount_vol.json | 成交额波动率 |
| quant_stock_data.py / quant_stock_data.json | 基础数据 |

## TODO
- [ ] 前端页面：超额净值叠环境背景色带
- [ ] 5因子仪表板卡片
- [ ] 条件诊断叙事面板
- [ ] 截面波动率历史扩展（目前仅5天）
- [ ] 其他4个策略的环境诊断模块
