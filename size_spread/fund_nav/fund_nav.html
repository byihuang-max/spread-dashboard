<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äº§å“å‡€å€¼è·Ÿè¸ª</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,'PingFang SC','Microsoft YaHei',sans-serif;background:#fff;color:#2d3142;padding:16px 20px}

.signal-bar{background:linear-gradient(135deg,#1e2433,#2a3350);border-radius:10px;padding:14px 18px;color:#e2e6ed;margin-bottom:14px}
.signal-bar .title{font-size:14px;font-weight:800;margin-bottom:6px}
.signal-bar .tags{display:flex;gap:6px;flex-wrap:wrap}
.signal-bar .tag{padding:3px 10px;border-radius:18px;font-size:11px;font-weight:600}
.tag-green{background:rgba(34,197,94,.2);color:#4ade80}
.tag-red{background:rgba(239,68,68,.2);color:#f87171}
.tag-blue{background:rgba(59,130,246,.2);color:#60a5fa}
.tag-amber{background:rgba(245,158,11,.25);color:#fbbf24}

.cards{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
@media(max-width:800px){.cards{grid-template-columns:repeat(2,1fr)}}
.card{background:#fafbfc;border:1px solid #e8ecf1;border-radius:8px;padding:12px 14px;border-left:4px solid #6366f1}
.card .label{font-size:11px;color:#6b7280;margin-bottom:2px}
.card .value{font-size:18px;font-weight:800}
.card .sub{font-size:10px;color:#94a3b8;margin-top:2px}
.pos{color:#16a34a}.neg{color:#dc2626}

.chart-box{background:#fff;border:1px solid #e8ecf1;border-radius:10px;padding:14px;margin-bottom:14px}
.chart-title{font-size:13px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.chart-title .dot{width:8px;height:8px;border-radius:50%;display:inline-block}

.notes{background:#f8fafc;border:1px solid #e8ecf1;border-radius:10px;padding:14px;font-size:11px;color:#64748b;line-height:1.7}
.notes b{color:#374151}

#loading{text-align:center;padding:40px;color:#8b92a5}
</style>
</head>
<body>
<div id="loading">åŠ è½½ä¸­...</div>
<div id="content" style="display:none">

<div class="signal-bar">
  <div class="title">ğŸ“Š äº§å“å‡€å€¼è·Ÿè¸ª</div>
  <div class="tags" id="signalTags"></div>
  <div style="font-size:10px;color:#7c8598;margin-top:6px" id="updateTime"></div>
</div>

<div class="cards" id="cards"></div>

<div class="chart-box">
  <div class="chart-title"><span class="dot" style="background:#6366f1"></span> å‡€å€¼ä¸è¶…é¢æ›²çº¿</div>
  <div style="position:relative;height:340px"><canvas id="mainChart"></canvas></div>
</div>

<div class="notes" id="notes">
  <b>ğŸ“Œ æŒ‡æ ‡è¯´æ˜</b><br>
  <b>å½’ä¸€åŒ–å‡€å€¼ï¼š</b>ä»¥èµ·å§‹æ—¥ä¸ºåŸºå‡†=1ï¼Œå±•ç¤ºäº§å“å’ŒåŸºå‡†æŒ‡æ•°çš„ç´¯è®¡è¡¨ç°å¯¹æ¯”ã€‚<br>
  <b>ç´¯è®¡è¶…é¢ï¼ˆå³è½´ï¼‰ï¼š</b>äº§å“å½’ä¸€åŒ–å‡€å€¼ - åŸºå‡†å½’ä¸€åŒ–å‡€å€¼ã€‚æ­£å€¼è¡¨ç¤ºè·‘èµ¢åŸºå‡†ï¼Œæ›²çº¿æ–œç‡å‘ä¸Š=æŒç»­åˆ›é€ è¶…é¢ã€‚<br>
  <b>æ•°æ®æ¥æºï¼š</b>ç«å¯Œç‰›æ•°æ®å•†åŸï¼ˆå›¢é˜Ÿå‡€å€¼ï¼Œå‘¨é¢‘æ›´æ–°ï¼‰ã€‚åŸºå‡†ä¸ºå¯¹åº”æŒ‡æ•°ï¼ˆæ—¥é¢‘ï¼Œå–äº§å“å‡€å€¼æ—¥å¯¹é½ï¼‰ã€‚
</div>

</div>

<script>
  var params=new URLSearchParams(window.location.search);
  var tabFilter=params.get('tab')||'';
  var jsonFile=tabFilter?'fund_nav_'+tabFilter+'.json':'fund_nav.json';

fetch(jsonFile+'?t='+Date.now()).then(function(r){return r.json()}).then(function(D){
  document.getElementById('loading').style.display='none';
  document.getElementById('content').style.display='';
  document.getElementById('updateTime').textContent='æ›´æ–°: '+(D.update_time||'');

  // ç‹¬ç«‹JSONç”¨D.fundï¼Œåˆå¹¶JSONç”¨D.funds[0]
  var f=D.fund||(D.funds||[])[0];

  if(!f){
    document.getElementById('content').innerHTML='<div style="text-align:center;padding:40px;color:#999">æš‚æ— æ•°æ®</div>';
    return;
  }

  var c=f.chart;
  var fundLabel=f.show_name!==false?f.name:'ä»£è¡¨äº§å“';

  // ä¿¡å·
  var tags=[];
  if(f.show_name!==false) tags.push({text:f.name,cls:'tag-blue'});
  tags.push({text:'äº§å“ '+(f.total_return>0?'+':'')+f.total_return+'%',cls:f.total_return>=0?'tag-green':'tag-red'});
  tags.push({text:f.benchmark_name+' '+(f.index_return>0?'+':'')+f.index_return+'%',cls:'tag-amber'});
  tags.push({text:'è¶…é¢ '+(f.excess_return>0?'+':'')+f.excess_return+'%',cls:f.excess_return>=0?'tag-green':'tag-red'});
  document.getElementById('signalTags').innerHTML=tags.map(function(t){return '<span class="tag '+t.cls+'">'+t.text+'</span>'}).join('');

  // å¡ç‰‡
  document.getElementById('cards').innerHTML=[
    {label:'äº§å“ç´¯è®¡æ”¶ç›Š',value:(f.total_return>0?'+':'')+f.total_return+'%',cls:f.total_return>=0?'pos':'neg',sub:fundLabel},
    {label:f.benchmark_name+'æ”¶ç›Š',value:(f.index_return>0?'+':'')+f.index_return+'%',cls:f.index_return>=0?'pos':'neg',sub:'åŸºå‡†æŒ‡æ•°'},
    {label:'ç´¯è®¡è¶…é¢',value:(f.excess_return>0?'+':'')+f.excess_return+'%',cls:f.excess_return>=0?'pos':'neg',sub:'äº§å“-åŸºå‡†'},
    {label:'æ•°æ®å‘¨æœŸ',value:f.count+'æœŸ',cls:'',sub:f.date_range},
  ].map(function(c){return '<div class="card"><div class="label">'+c.label+'</div><div class="value '+c.cls+'">'+c.value+'</div><div class="sub">'+c.sub+'</div></div>'}).join('');

  // ä¸‰åˆä¸€å›¾è¡¨ï¼šäº§å“å‡€å€¼ï¼ˆå·¦è½´ï¼‰+ åŸºå‡†å‡€å€¼ï¼ˆå·¦è½´ï¼‰+ è¶…é¢ï¼ˆå³è½´ï¼‰
  var labels=c.dates.map(function(d){return d.slice(5)});

  new Chart(document.getElementById('mainChart'),{
    type:'line',
    data:{
      labels:labels,
      datasets:[
        {
          label:fundLabel,
          data:c.fund_nav,
          borderColor:'#6366f1',
          backgroundColor:'rgba(99,102,241,.06)',
          fill:true,
          pointRadius:0,
          borderWidth:2.5,
          tension:.3,
          yAxisID:'y'
        },
        {
          label:f.benchmark_name,
          data:c.index_nav,
          borderColor:'#94a3b8',
          backgroundColor:'transparent',
          pointRadius:0,
          borderWidth:1.5,
          tension:.3,
          borderDash:[5,3],
          yAxisID:'y'
        },
        {
          label:'ç´¯è®¡è¶…é¢',
          data:c.excess,
          borderColor:'#f59e0b',
          backgroundColor:'rgba(245,158,11,.08)',
          fill:true,
          pointRadius:0,
          borderWidth:2,
          tension:.3,
          yAxisID:'y1'
        }
      ]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{
          position:'top',
          labels:{font:{size:11},usePointStyle:true,pointStyle:'circle'}
        },
        tooltip:{
          callbacks:{
            label:function(ctx){
              if(ctx.datasetIndex<=1){
                return ctx.dataset.label+': '+((ctx.parsed.y-1)*100).toFixed(1)+'%';
              } else {
                return ctx.dataset.label+': '+(ctx.parsed.y*100).toFixed(1)+'%';
              }
            }
          }
        }
      },
      scales:{
        x:{ticks:{maxTicksLimit:12,font:{size:10}},grid:{display:false}},
        y:{
          type:'linear',
          position:'left',
          ticks:{font:{size:10},callback:function(v){return ((v-1)*100).toFixed(0)+'%'}},
          grid:{color:'rgba(0,0,0,.04)'},
          title:{display:true,text:'ç´¯è®¡æ”¶ç›Š',font:{size:10},color:'#6366f1'}
        },
        y1:{
          type:'linear',
          position:'right',
          ticks:{font:{size:10},callback:function(v){return (v*100).toFixed(0)+'%'},color:'#f59e0b'},
          grid:{drawOnChartArea:false},
          title:{display:true,text:'è¶…é¢',font:{size:10},color:'#f59e0b'}
        }
      }
    }
  });

}).catch(function(e){document.getElementById('loading').textContent='åŠ è½½å¤±è´¥: '+e.message});
</script>
</body>
</html>
